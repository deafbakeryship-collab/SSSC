<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¤…ä¹¾é«˜æ‰‹ - é€²éšé€²å‡ºåº«ç³»çµ±</title>
    <script src="https://unpkg.com/html5-qrcode"></script>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; margin: 0; padding: 15px; text-align: center; }
        #reader { width: 100%; max-width: 400px; margin: auto; border-radius: 10px; overflow: hidden; }
        .card { background: white; padding: 20px; border-radius: 15px; margin-top: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        .product-name { font-size: 20px; color: #2c3e50; font-weight: bold; margin: 10px 0; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        .qty-input-group { margin: 20px 0; }
        input[type="number"] { width: 80px; padding: 10px; font-size: 20px; text-align: center; border: 2px solid #ddd; border-radius: 5px; }
        .btn-group { display: flex; gap: 10px; }
        button { flex: 1; padding: 15px; font-size: 18px; border: none; border-radius: 8px; color: white; cursor: pointer; font-weight: bold; }
        .btn-in { background: #27ae60; }
        .btn-out { background: #c0392b; }
        #log { font-size: 12px; color: #7f8c8d; margin-top: 10px; }
    </style>
</head>
<body>

    <div id="reader"></div>

    <div class="card">
        <div id="display-name" class="product-name">è«‹æƒæé¤…ä¹¾æ¢ç¢¼</div>
        <div id="display-id" style="color:#999; font-size: 12px;">ID: ---</div>

        <div class="qty-input-group">
            <label>ç•°å‹•æ•¸é‡ï¼š</label><br><br>
            <input type="number" id="qty" value="1" min="1">
        </div>
        
        <div class="btn-group">
            <button class="btn-in" onclick="submitData('å…¥åº«')">ğŸ“¥ æ‰¹æ¬¡å…¥åº«</button>
            <button class="btn-out" onclick="submitData('å‡ºåº«')">ğŸ“¤ æ‰¹æ¬¡å‡ºåº«</button>
        </div>
        <div id="log">ç³»çµ±å°±ç·’</div>
    </div>

    <script>
        const GAS_URL = "ä½ çš„_GAS_ç¶²å€";
        let lastResult = "";

        // æ¨¡æ“¬ç”¢å“å°ç…§è¡¨ (å¯¦å‹™ä¸Šå¯æ”¹ç‚ºå¾ GAS æŠ“å–)
        const products = {
            "CK-001": "å·§å…‹åŠ›æ‰‹å·¥æ›²å¥‡",
            "CK-002": "ç‡•éº¥è”“è¶Šè“é¤…ä¹¾",
            "CK-003": "ä¼¯çˆµç´…èŒ¶å°é…¥é¤…"
        };

        function onScanSuccess(decodedText) {
            if (decodedText !== lastResult) {
                lastResult = decodedText;
                document.getElementById('display-id').innerText = "ID: " + decodedText;
                // è‡ªå‹•å°ç…§åç¨±
                document.getElementById('display-name').innerText = products[decodedText] || "æœªçŸ¥ç”¢å“";
                if (navigator.vibrate) navigator.vibrate(50);
            }
        }

        function submitData(action) {
            const qty = document.getElementById('qty').value;
            if (!lastResult) return alert("è«‹å…ˆæƒæï¼");
            
            document.getElementById('log').innerText = "ä¸Šå‚³ä¸­...";

            const data = {
                barcode: lastResult,
                name: products[lastResult] || "æœªçŸ¥ç”¢å“",
                action: action,
                amount: parseInt(qty)
            };

            fetch(GAS_URL, {
                method: "POST",
                mode: "no-cors",
                body: JSON.stringify(data)
            })
            .then(() => {
                alert(`æˆåŠŸï¼${data.name} ${action} ${qty} åŒ…`);
                document.getElementById('log').innerText = "æ›´æ–°å®Œæˆ";
                // é‡ç½®
                document.getElementById('qty').value = 1;
            });
        }

        const scanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });
        scanner.render(onScanSuccess);
    </script>
</body>
</html>